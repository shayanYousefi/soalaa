<template>
  <div class="bg-primary side-menu-main-layout">
    <div class="side-logo">
      <div class="logo-image">
        <router-link :to="{name: 'HomePage'}">
          <svg width="1154"
               height="600"
               viewBox="0 0 1154 600"
               fill="none"
               xmlns="http://www.w3.org/2000/svg">
            <path d="M376.661 115.386H314.443V434.259H376.661V115.386Z"
                  fill="white" />
            <path d="M203.427 334.288C203.427 339.268 202.443 344.199 200.533 348.799C198.622 353.4 195.821 357.58 192.291 361.102C188.76 364.623 184.568 367.416 179.955 369.322C175.342 371.227 170.398 372.208 165.405 372.208H150.991L108.372 115.989L47.053 126.124L87.9266 372.208H46.1543V434.259H165.405C191.98 434.227 217.458 423.684 236.25 404.943C255.041 386.202 265.613 360.792 265.645 334.288V115.386H203.427V334.288Z"
                  fill="white" />
            <path d="M1045.48 196.699V336.004C1045.48 346.061 1041.47 355.706 1034.34 362.817C1027.21 369.929 1017.54 373.924 1007.46 373.924H988.946V213.936H926.728V336.004C926.728 346.061 922.722 355.706 915.592 362.817C908.461 369.929 898.79 373.924 888.706 373.924H837.895C837.231 373.924 836.567 373.883 835.907 373.803C835.726 373.105 835.633 372.387 835.631 371.666V213.936H773.413V336.004C773.413 336.659 773.413 337.314 773.413 337.952C773.413 338.279 773.413 338.589 773.413 338.917C773.413 339.244 773.413 339.555 773.413 339.865C773.413 340.175 773.327 340.434 773.292 340.709C773.258 340.985 773.292 341.416 773.171 341.761L773.016 342.571C773.016 342.933 772.895 343.278 772.826 343.622C772.756 343.967 772.705 344.122 772.653 344.381C772.601 344.639 772.497 345.105 772.411 345.467L772.203 346.173L771.892 347.259L771.633 348C771.529 348.345 771.408 348.69 771.287 349.017C771.166 349.345 771.115 349.483 771.011 349.724C770.907 349.965 770.752 350.396 770.613 350.741L770.25 351.551C770.112 351.844 769.991 352.137 769.853 352.413C769.715 352.689 769.576 352.93 769.455 353.206L769.006 354.05C768.885 354.292 768.747 354.516 768.609 354.757C768.47 354.998 768.28 355.343 768.09 355.636C767.9 355.929 767.814 356.067 767.675 356.291L767.105 357.187L766.656 357.808C766.448 358.101 766.258 358.394 766.051 358.67L765.549 359.29L764.91 360.1C764.755 360.307 764.564 360.497 764.392 360.704C764.219 360.911 763.96 361.221 763.718 361.479C763.476 361.738 763.337 361.876 763.147 362.083L762.473 362.789L761.816 363.41C761.592 363.617 761.384 363.841 761.142 364.048L760.451 364.651L759.777 365.237L759.051 365.806L758.343 366.357L757.582 366.892L756.839 367.426L756.079 367.926L755.301 368.408L754.506 368.874C754.247 369.029 753.987 369.184 753.711 369.322L752.847 369.77L752.086 370.166L751.188 370.563L750.393 370.925L749.528 371.27L748.664 371.614L747.783 371.907L746.901 372.2C746.625 372.304 746.314 372.373 746.02 372.459L745.104 372.717C744.81 372.717 744.499 372.855 744.205 372.924L743.272 373.148L742.322 373.321L741.406 373.476L740.455 373.596L739.504 373.717L738.554 373.803H737.569H736.653H735.599L683.18 373.459V270.816C683.153 244.31 672.583 218.898 653.79 200.156C634.998 181.414 609.517 170.872 582.94 170.845H524.3C497.723 170.872 472.243 181.414 453.45 200.156C434.658 218.898 424.088 244.31 424.061 270.816V335.194C424.093 361.698 434.664 387.107 453.455 405.849C472.247 424.59 497.725 435.133 524.3 435.165H600.448C587.338 456.252 571.256 475.35 552.696 491.873C539.383 503.723 524.841 514.124 509.316 522.898L539.941 576.917C559.32 565.97 577.477 552.998 594.105 538.221C620.607 514.621 643.019 486.818 660.436 455.935C664.152 449.374 667.425 442.573 670.235 435.579L704.282 435.803V435.975H735.391C755.681 435.992 775.494 429.834 792.182 418.325C802.932 429.08 818.244 435.975 837.895 435.975H888.706C890.434 435.975 892.163 435.975 893.891 435.837C911.774 434.953 929.088 429.279 944.011 419.411C954.733 430.001 969.207 435.952 984.297 435.975H1007.46C1034.03 435.943 1059.51 425.4 1078.3 406.659C1097.09 387.918 1107.66 362.508 1107.7 336.004V196.699H1045.48ZM486.278 335.194V270.816C486.278 260.759 490.284 251.114 497.415 244.002C504.545 236.891 514.216 232.896 524.3 232.896H582.75C592.834 232.896 602.505 236.891 609.636 244.002C616.766 251.114 620.772 260.759 620.772 270.816V369.443C620.772 370.672 620.772 371.896 620.772 373.114H611.301L580.4 372.907V373.114H524.3C514.216 373.114 504.545 369.119 497.415 362.007C490.284 354.896 486.278 345.251 486.278 335.194Z"
                  fill="white" />
          </svg>
        </router-link>
      </div>
    </div>
    <q-list class="side-menu-list"
            padding
            dark>
      <q-expansion-item class="side-expansion-list top-expansion"
                        :header-style="{fontSize:'16px', height:'40px', borderRadius: '14px'}"
                        label="برنامه ی آزمون ها"
                        dark>
        <q-list class="list-expansion"
                padding>
          <div v-for="(examPlan, index) in examsPlan"
               :key="index">
            <a v-if="!examPlan.divider"
               :href="examPlan.link"
               target="_blank">
              <q-item v-ripple:deep-purple
                      clickable
                      :active="false"
                      active-class="active-route">
                <q-item-section class="item-list-expansion">
                  <span class="item-list-expansion-title">
                    {{ examPlan.name }}
                  </span>
                </q-item-section>
              </q-item>
            </a>
            <q-separator v-else
                         class="top-expansion-separator"
                         size="2px"
                         dark />
          </div>
        </q-list>
      </q-expansion-item>
      <q-separator class="top-separator"
                   size="2px"
                   dark />
      <div v-for="(item , index) in titlesList"
           :key="index">
        <div v-if="showMenuItem(item)">
          <q-expansion-item v-if="item.title === 'ویرایش صفحه' && this.$route.name === 'HomePage'"
                            :header-style="{fontSize:'16px', height:'40px', borderRadius: '14px'}"
                            :label="item.title"
                            :icon="item.icon"
                            class="side-expansion-list"
                            dark>
            <div class="expansion-body">
              <q-separator dark
                           size="2px"
                           vertical
                           class="vertical-separator" />
              <q-list class="list-expansion">
                <q-item v-for="(subItem , i) in item.children"
                        :key="i"
                        class="list-child-item"
                        exact-active-class="active-route">
                  <q-item-section class="list-child-section"
                                  @click="editPage(subItem.name)">
                    {{ subItem.displayName }}
                  </q-item-section>
                  <span class="indicator" />
                </q-item>
              </q-list>
            </div>
          </q-expansion-item>

          <q-expansion-item v-if="item.children.length && item.title !== 'ویرایش صفحه'"
                            :header-style="{fontSize:'16px', height:'40px', borderRadius: '14px'}"
                            :label="item.title"
                            :icon="item.icon"
                            class="side-expansion-list"
                            dark>
            <div class="expansion-body">
              <q-separator dark
                           size="2px"
                           vertical
                           class="vertical-separator" />
              <q-list class="list-expansion">
                <q-item v-for="(subItem , i) in item.children"
                        :key="i"
                        :to="{ name: subItem.routeName, params: subItem.params }"
                        class="list-child-item"
                        exact-active-class="active-route">
                  <q-item-section class="list-child-section">
                    {{ subItem.displayName }}
                  </q-item-section>
                  <span class="indicator" />
                </q-item>
              </q-list>
            </div>
          </q-expansion-item>
          <q-item v-else-if="item.title !== 'ویرایش صفحه'"
                  v-model="clickedItem"
                  :to="(item.routeName) ? {name: item.routeName} : null"
                  class="item-list"
                  :class="{ 'alone-item': !item.children.length}"
                  exact-active-class="active-route">
            <div class="section-title">
              <q-item-section class="list-section title-icon"
                              avatar>
                <q-avatar :icon="item.icon"
                          size="30" />
              </q-item-section>
              <q-item-section class="list-section">
                {{ item.title }}
              </q-item-section>
              <span class="indicator" />
            </div>
          </q-item>
        </div>
      </div>
    </q-list>
    <div class="log-out"
         @click="logOut">
      <span>
        <q-avatar icon="isax:logout"
                  size="30"
                  dir="rtl" />
      </span>
      <span class="logout-text">خروج </span>
    </div>
  </div>
</template>

<script>
import { User } from 'src/models/User.js'
export default {
  name: 'SideMenu-dashboard',
  data () {
    return {
      clickedItem: null,
      user: new User(),
      titlesList: [
        {
          title: 'صفحه اصلی',
          icon: 'isax:home',
          permission: 'all',
          routeName: 'HomePage',
          active: false,
          children: []
        },
        {
          title: 'پنل ادمین',
          icon: 'isax:admin',
          permission: 'examStore',
          routeName: 'Admin.Exam.Index',
          active: false,
          children: []
        },
        {
          title: 'ویرایش صفحه',
          icon: 'isax:edit',
          permission: 'examStore',
          active: false,
          children: [
            {
              name: 'edit',
              displayName: 'حالت ویرایش'
            },
            {
              name: 'default',
              displayName: 'حالت عادی'
            },
            {
              name: 'accept',
              displayName: 'تایید ویرایش'
            },
            {
              name: 'cancel',
              displayName: 'بازگشت به حالت اول'
            }
          ]
        },
        // {
        //   title: 'داشبورد',
        //   icon: 'isax:home',
        //   routeName: 'dashboard',
        //   permission: 'all',
        //   active: false,
        //   children: []
        // },
        {
          title: 'سوال',
          icon: 'isax:bank',
          routeName: null,
          permission: 'examStore',
          active: false,
          children: [
            {
              displayName: 'ثبت سوال',
              routeName: 'Admin.Question.Create.Image',
              params: {
                questionType: 'multipleChoice'
              },
              active: false
            },
            // { displayName: 'ثبت سوال', routeName: 'a', active: false },
            // { displayName: 'کارخانه سوال', routeName: 'Admin.Question.Factory', active: false },
            { displayName: 'بانک سوال', routeName: 'Admin.Question.Bank', active: false }
          ]
        },
        {
          title: 'ویژگی سوال',
          icon: 'isax:bank',
          permission: 'examStore',
          routeName: null,
          active: false,
          children: [
            { displayName: 'مرجع سوال', routeName: 'Admin.QuestionAuthors.Index', active: false },
            { displayName: 'گزارش خطا سوال', routeName: 'Admin.QuestionReport.Index', active: false },
            // { displayName: 'معلفان سوال', routeName: 'Admin.QuestionAuthors.Index', active: false },
            { displayName: 'تاریخ تالیف', routeName: 'Admin.AuthorshipDates.Index', active: false },
            { displayName: 'اهداف', routeName: 'Admin.QuestionTarget.Index', active: false },
            { displayName: 'رشته تحصیلی', routeName: 'Admin.Majors.Index', active: false }
          ]
        },
        {
          title: 'آزمون',
          icon: 'isax:task-square',
          permission: 'examStore',
          routeName: null,
          active: false,
          children: [
            // { displayName: 'ساخت آزمون', routeName: 'Admin.Exam.Create.AttachQuestion', active: false },
            { displayName: 'لیست آزمون ها', routeName: 'Admin.Exam.Index', active: false }
          ]
        },
        {
          title: 'تیکت',
          icon: 'isax:clipboard-text',
          routeName: 'Admin.Ticket.Index',
          permission: 'examStore',
          active: false,
          children: []
        },
        {
          title: 'سفارش‌ های من',
          icon: 'isax:clipboard-text',
          routeName: 'User.MyOrders',
          permission: 'all',
          active: false,
          children: []
        },
        {
          title: 'درخت دانش',
          icon: 'isax:tree',
          permission: 'examStore',
          routeName: 'Admin.KnowledgeTree.tree',
          active: false,
          children: []
        },
        {
          title: 'درخت تگ موضوعی',
          icon: 'isax:tree',
          permission: 'examStore',
          routeName: 'Admin.SubjectTree.tree',
          active: false,
          children: []
        },
        {
          title: 'لیست دروس',
          icon: 'isax:book',
          routeName: 'Admin.subCategory.Index',
          permission: 'examStore',
          active: false,
          children: []
        },
        {
          title: 'لیست دفترچه ها',
          icon: 'isax:book',
          routeName: 'Admin.Category.Index',
          permission: 'examStore',
          active: false,
          children: []
        },
        // {
        //   title: 'گزارشات',
        //   icon: 'isax:graph',
        //   permission: 'examStore',
        //   routeName: null,
        //   active: false,
        //   children: []
        // },
        // {
        //   title: 'تنظیمات',
        //   icon: 'isax:setting-2',
        //   routeName: 'Admin.Settings',
        //   permission: 'examStore',
        //   active: false,
        //   children: []
        // },
        {
          title: 'سوالات متداول',
          icon: 'isax:message-question',
          permission: 'all',
          routeName: 'faq',
          active: false,
          children: []
        }
      ],
      examsPlan: [
        {
          divider: true
        },
        {
          name: 'دهم تجربی',
          link: 'https://nodes.alaatv.com/aaa/pdf/1401_plan_tajrobi_dahom.pdf'
        },
        {
          name: 'دهم ریاضی',
          link: 'https://nodes.alaatv.com/aaa/pdf/1401_plan_riyazi_dahom.pdf'
        },
        {
          name: 'دهم انسانی',
          link: 'https://nodes.alaatv.com/aaa/pdf/1401_plan_ensani_dahom.pdf'
        },
        {
          divider: true
        },
        {
          name: 'یازدهم تجربی',
          link: 'https://nodes.alaatv.com/aaa/pdf/1401_plan_tajrobi_yazdahom.pdf'
        },
        {
          name: 'یازدهم ریاضی',
          link: 'https://nodes.alaatv.com/aaa/pdf/1401_plan_riyazi_yazdahom.pdf'
        },
        {
          name: 'یازدهم انسانی',
          link: 'https://nodes.alaatv.com/aaa/pdf/1401_plan_ensani_yazdahom.pdf'
        },
        {
          divider: true
        },
        {
          name: 'دوازدهم تجربی',
          link: 'https://nodes.alaatv.com/aaa/pdf/1401_plan_tajrobi_davazdahom.pdf'
        },
        {
          name: 'دوازدهم ریاضی',
          link: 'https://nodes.alaatv.com/aaa/pdf/1401_plan_riyazi_davazdahom.pdf'
        },
        {
          name: 'دوازدهم انسانی',
          link: 'https://nodes.alaatv.com/aaa/pdf/1401_plan_ensani_davazdahom.pdf'
        }
      ]
    }
  },
  computed: {
    showMenuItem () {
      return (item) => {
        return (item.permission === 'all' || this.user.hasPermission(item.permission))
      }
    }
  },
  mounted () {
    this.loadAuthData()
  },
  methods: {
    loadAuthData () { // prevent Hydration node mismatch
      this.user = this.$store.getters['Auth/user']
    },
    logOut () {
      this.$store.dispatch('Auth/logOut')
        .then(() => {
          this.$router.push({ name: 'login' })
        })
    },
    togglePageBuilderEditable () {
      const state = this.$store.getters['PageBuilder/pageBuilderEditable']
      this.$store.commit('PageBuilder/updatePageBuilderEditable', !state)
    },
    editPage(name) {
      if (name === 'edit' || name === 'default') {
        this.togglePageBuilderEditable()
      }
      if (name === 'accept') {
        const currentSections = this.$store.getters['PageBuilder/currentSections']
        this.$store.dispatch('PageBuilder/editPageWidget', { key: 'homePage', sections: currentSections })
        this.togglePageBuilderEditable()
      }
      if (name === 'cancel') {
        const initialSections = this.$store.getters['PageBuilder/initialSections']
        this.$store.commit('PageBuilder/updateCurrentSections', initialSections)
        this.togglePageBuilderEditable()
      }
    }
  }
}
</script>

<style lang="scss" scoped>
.side-menu-main-layout {
  display: flex;
  flex-direction: column;
  width: 280px;
  min-height: 840px;
  border-radius: 30px;
  margin: 40px 0 0 24px;
  @media screen and (max-width: 1919px) {
    width: 260px;
    min-height: 740px;
    margin: 30px 30px 30px 24px;
  }
  @media screen and (max-width: 1439px) {
    margin: 0 !important;
    border-radius: 0;
    width: 280px;
    min-height: 680px;
    height: 100%;
  }
  @media screen and (max-width: 599px) {
    width: 100%;
  }

  .side-logo {
    display: flex;
    height: 167px;
    align-items: center;
    justify-content: center;
    @media screen and (max-width: 1919px) {
      height: 136px;
    }
    @media screen and (max-width: 1439px) {
      height: 100px;
    }
    @media screen and (max-width: 599px) {
      height: 110px;
    }

    .logo-image {
      width: 140px;
      height: 95px;
      @media screen and (max-width: 1919px) {
        height: 76px;
      }
      @media screen and (max-width: 1439px) {
        width: 100px;
        height: 50px;
      }
      svg {
        width: 100%;
        height: 100%;
      }

      .q-img__container {
        width: 140px;
        height: 95px;
        @media screen and (max-width: 1919px) {
          height: 76px;
        }
        @media screen and (max-width: 1439px) {
          width: 100px;
          height: 50px;
        }
      }
    }
  }

  .q-list {
    padding: 0;

    &.side-menu-list {
      margin: 0 24px 109px 24px;
      @media screen and (max-width: 1919px) {
        margin: 0 24px 34px 24px;
      }
      @media screen and (max-width: 1439px) {
        margin: 0 21px 26px 21px;
      }
      @media screen and (max-width: 599px) {
        margin: 0 18px 8px 18px;
      }

      .top-separator {
        margin: 0 40px 32px 40px;
        @media screen and (max-width: 1919px) {
          margin: 0 30px 25px 30px;
        }
        @media screen and (max-width: 1439px) {
          margin: 0 45px 22px 45px;
        }
      }

      .q-item {
        padding: 0;
        min-height: 0;

        &.item-list {
          display: flex;
          flex-direction: column;
          justify-content: center;
          font-size: 16px;
          font-weight: 500;
          cursor: pointer;
          padding: 0 14px 0 10px;
          border-radius: 14px;

          &.alone-item {
            height: 40px;

            &.active-route {
              .indicator {
                height: 8px;
                width: 8px;
                background-color: white;
                border-radius: 50%;
                margin: auto;
              }
            }
          }

          .section-title {
            height: 30px;
            display: flex;
            flex-direction: row;
            align-items: center;

            .title-icon {
              margin-right: 12px;
            }

            .q-item__section--side {
              padding: 0;
            }
          }

          .list-section {
            display: flex;
            flex-direction: row;
            justify-content: left;

            .q-avatar {
              height: 22px;
              width: 22px;
            }
          }
        }
      }

      .side-expansion-list {
        &.top-expansion {
          margin-bottom: 10px;
        }

        .expansion-body {
          display: flex;
          margin-left: 8px;
        }

        .q-expansion-item__content {
          .vertical-separator {
            margin: 6px 9px 9px 9px;
            @media screen and (max-width: 599px) {
              margin: 0 10px 12px 10px;
            }
          }
        }

        .q-list {
          &.list-expansion {
            margin-bottom: 0;

            .item-list-expansion {
              height: 30px;
              margin: 5px;

              .item-list-expansion-title {
                justify-content: start;
              }
            }

            .top-expansion-separator {
              margin: 0 40px 5px 40px;
              @media screen and (max-width: 1439px) {
                margin: 0 30px 5px 30px;
              }
              @media screen and (max-width: 599px) {
                margin: 0 45px 5px 45px;
              }
            }

            .list-child-item {
              height: 30px;
              justify-content: right;
              margin-bottom: 8px;
              width: 157px;
              border-radius: 10px;
              padding: 0 14px;
              @media screen and (max-width: 1439px) {
                width: 148px;
              }
              @media screen and (max-width: 599px) {
                width: 160px;
                margin-bottom: 5px;
                padding: 0 10px 0 12px;
              }

              &:last-child {
                margin-bottom: 0;
              }

              .list-child-section {
                font-size: 14px !important;
                justify-content: center;
              }
            }
          }
        }
      }

      .active-route {
        background-color: #8075DC;

        .indicator {
          height: 6px;
          width: 6px;
          background-color: white;
          border-radius: 50%;
          margin: auto;
        }
      }

    }

    .q-item__section--avatar {
      min-width: 0 !important;
    }

    a {
      text-decoration: none;
      color: white;
      padding: 0;
    }
  }

  .log-out {
    color: white;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    height: 40px !important;
    //width: 232px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    padding: 0 14px 0 10px;
    margin: 0 0 36px 27px;
    @media screen and (max-width: 1439px) {
      margin: 0 31px 33px 31px;
    }
    @media screen and (max-width: 599px) {
      margin: 0 30px 30px 30px;
      //padding: 0 0 0 10px;
    }

    &:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .q-avatar {
      height: 22px;
      width: 22px;
      margin-right: 12px;
      transform: matrix(-1, 0, 0, 1, 0, 0);
    }
  }
}
</style>
<style lang="scss">
.side-menu-main-layout {
  .q-expansion-item__container {
    .q-item {
      display: flex;
      padding: 0 10px !important;

    }

    .q-icon {
      font-size: 21px;
    }
  }
}

</style>
